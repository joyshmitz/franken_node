{
  "summary_id": "chg-20260220-control-lease-gate",
  "contract_version": "1.0",
  "change_summary": {
    "intent": "Add lease guard validation before control-plane finalize.",
    "scope": {
      "subsystems": [
        "franken_node.connector",
        "franken_node.control_plane"
      ],
      "modules": [
        "crates/franken-node/src/connector/lease_coordinator.rs",
        "crates/franken-node/src/connector/lease_service.rs"
      ]
    },
    "surface_area_delta": {
      "new_apis": [
        "POST /v1/fleet/lease/validate"
      ],
      "removed_apis": [],
      "changed_signatures": [
        "fn finalize_lease(...) -> Result<LeaseFinalizeReceipt, LeaseError>"
      ]
    },
    "affected_contracts": {
      "beads": [
        "bd-3se1",
        "bd-c781"
      ],
      "documents": [
        "docs/specs/fastapi_rust_integration_contract.md",
        "docs/specs/frankentui_integration_contract.md"
      ]
    },
    "operational_impact": {
      "operator_notes": "Lease validation now blocks finalize when stale fencing evidence is detected.",
      "required_actions": [
        "Run lease conformance checks before canary promotion.",
        "Update runbook escalation path for lease validation failures."
      ],
      "rollout_notes": "Enable in canary environment first, then expand fleet-wide."
    },
    "risk_delta": {
      "previous_tier": "high",
      "new_tier": "medium",
      "rationale": "Pre-finalize validation removes a class of stale-state lease approvals."
    },
    "compatibility": {
      "backward_compatibility": "compatible",
      "forward_compatibility": "enables",
      "details": "No removed runtime surfaces; this adds stricter validation with explicit failure receipts."
    },
    "dependency_changes": {
      "added": [],
      "removed": [],
      "updated": [
        "tokio: 1.44.0 -> 1.45.0"
      ]
    },
    "compatibility_and_threat_evidence": {
      "compatibility_test_suites": [
        {
          "suite_name": "tests/security/control_epoch_validity.rs",
          "pass_count": 6,
          "fail_count": 0,
          "artifact_path": "artifacts/11/compatibility_threat_evidence_contract.json"
        },
        {
          "suite_name": "tests/integration/frankentui_surface_migration.rs",
          "pass_count": 44,
          "fail_count": 0,
          "artifact_path": "artifacts/10.16/frankentui_surface_inventory.csv"
        }
      ],
      "regression_risk_assessment": {
        "risk_level": "medium",
        "api_families": [
          "POST /v1/fleet/lease/validate",
          "fn finalize_lease(...) -> Result<LeaseFinalizeReceipt, LeaseError>"
        ],
        "notes": "Validation adds stricter controls on existing paths; no endpoint removals."
      },
      "threat_vectors": [
        {
          "vector": "privilege_escalation",
          "mitigation": "Lease finalize now requires current fencing evidence before commit."
        },
        {
          "vector": "data_exfiltration",
          "mitigation": "Validation failures redact sensitive internals in operator-facing receipts."
        },
        {
          "vector": "denial_of_service",
          "mitigation": "Retry bounds and validation caching reduce repeated expensive checks."
        }
      ]
    },
    "ev_score_and_tier": {
      "ev_score": 72,
      "tier": "T3",
      "dimension_scores": {
        "code_review": {
          "score": 0.8,
          "evidence_ref": "artifacts/11/benchmark_correctness_contract.json",
          "assessed_at": "2026-02-21T00:00:00Z"
        },
        "test_coverage": {
          "score": 0.7,
          "evidence_ref": "artifacts/section_11/bd-3l8d/correctness_suite_output.txt",
          "assessed_at": "2026-02-21T00:00:00Z"
        },
        "security_audit": {
          "score": 0.75,
          "evidence_ref": "artifacts/11/compatibility_threat_evidence_contract.json",
          "assessed_at": "2026-02-21T00:00:00Z"
        },
        "supply_chain": {
          "score": 0.65,
          "evidence_ref": "artifacts/11/rollback_command_contract.json",
          "assessed_at": "2026-02-21T00:00:00Z"
        },
        "conformance": {
          "score": 0.7,
          "evidence_ref": "artifacts/section_11/bd-3l8d/benchmark_metrics.json",
          "assessed_at": "2026-02-21T00:00:00Z"
        }
      },
      "rationale": "Tier T3 justified by consistent conformance and audit-backed controls."
    },
    "expected_loss_model": {
      "scenarios": [
        {
          "name": "rollback-command regression",
          "probability": 0.1,
          "impact_value": 250,
          "impact_unit": "dollars",
          "mitigation": "Rollback command exercised in CI and canary."
        },
        {
          "name": "compatibility divergence",
          "probability": 0.05,
          "impact_value": 1200,
          "impact_unit": "dollars",
          "mitigation": "Lockstep verification suite blocks promotion."
        },
        {
          "name": "operator runbook delay",
          "probability": 0.2,
          "impact_value": 80,
          "impact_unit": "dollars",
          "mitigation": "Structured playbook with on-call escalation."
        }
      ],
      "aggregate_expected_loss": 101,
      "confidence_interval": {
        "lower": 80,
        "upper": 140,
        "confidence_level": 0.95
      },
      "loss_category": "minor"
    },
    "fallback_trigger": {
      "trigger_conditions": [
        "error_rate > 0.05 over 60s sliding window"
      ],
      "fallback_target_state": "last_known_good_checkpoint",
      "rollback_mechanism": "automatic",
      "max_detection_latency_s": 3,
      "recovery_time_objective_s": 20,
      "subsystem_id": "franken_node.control_plane",
      "rationale": "Fast fallback keeps failure blast radius bounded during staged rollout."
    },
    "rollout_wedge": {
      "wedge_stages": [
        {
          "stage_id": "canary-5",
          "target_percentage": 5,
          "duration_hours": 2,
          "success_criteria": [
            "error_rate <= 0.02",
            "p95_latency_ms <= 35"
          ],
          "rollback_trigger": "error_rate > 0.05"
        },
        {
          "stage_id": "regional-20",
          "target_percentage": 20,
          "duration_hours": 4,
          "success_criteria": [
            "error_rate <= 0.02",
            "no critical alerts"
          ],
          "rollback_trigger": "critical_alert_count > 0"
        }
      ],
      "initial_percentage": 5,
      "increment_policy": "manual",
      "max_blast_radius": 25,
      "observation_window_hours": 1,
      "wedge_state": "ACTIVE"
    },
    "rollback_command": {
      "command": "franken-node rollback apply --receipt artifacts/rollback/lease_guard_receipt.json --force-safe",
      "idempotent": true,
      "tested_in_ci": true,
      "test_evidence_artifact": "artifacts/section_11/bd-nglx/rollback_command_ci_test.json",
      "rollback_scope": {
        "reverts": [
          "lease guard validation policy profile",
          "control-plane feature flag for lease finalize checks",
          "compatibility gate override used by lease finalize path"
        ],
        "does_not_revert": [
          "audit events already emitted to evidence ledger",
          "externally consumed workflow events",
          "historical replay bundles exported before rollback"
        ]
      },
      "estimated_duration": "2m30s"
    },
    "benchmark_and_correctness_artifacts": {
      "benchmark_metrics": [
        {
          "metric_name": "p95_latency_ms",
          "unit": "ms",
          "measured_value": 31.4,
          "baseline_value": 29.8,
          "delta": 1.6,
          "within_acceptable_bounds": true,
          "artifact_path": "artifacts/section_11/bd-3l8d/benchmark_metrics.json"
        },
        {
          "metric_name": "throughput_rps",
          "unit": "req/s",
          "measured_value": 4512,
          "baseline_value": 4488,
          "delta": 24,
          "within_acceptable_bounds": true,
          "artifact_path": "artifacts/section_11/bd-3l8d/benchmark_metrics.json"
        }
      ],
      "correctness_suites": [
        {
          "suite_name": "tests/security/control_epoch_validity.rs",
          "pass_count": 6,
          "fail_count": 0,
          "coverage_percent": 92.1,
          "raw_output_artifact": "artifacts/section_11/bd-3l8d/correctness_suite_output.txt"
        },
        {
          "suite_name": "tests/integration/frankentui_surface_migration.rs",
          "pass_count": 44,
          "fail_count": 0,
          "coverage_percent": 88.4,
          "raw_output_artifact": "artifacts/section_11/bd-3l8d/correctness_suite_output.txt"
        }
      ]
    }
  }
}
