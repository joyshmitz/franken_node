# Policy: Incident Bundle Retention and Export

**Bead:** bd-f2y | **Section:** 10.8 (Operational Readiness)
**Effective:** 2026-02-20
**Owner:** Operations Track (10.8)

## Purpose

This policy governs the lifecycle of incident bundles in the franken_node
control plane.  It defines format requirements, retention schedules, export
procedures, and compliance obligations to ensure that incident evidence is
preserved for operational review, regulatory audit, and forensic analysis.

## Scope

This policy applies to all incident bundles generated by the franken_node
system, including:

- Control-plane incident recordings
- Security incident evidence packages
- Operational degradation reports
- Compliance audit evidence snapshots

## Bundle Format Requirements

### Mandatory Fields

Every incident bundle MUST include:

1. **bundle_id**: Unique identifier in the format `ibr-<sha256-prefix>`
2. **incident_id**: Parent incident reference
3. **created_at**: RFC 3339 timestamp of bundle creation
4. **severity**: Classification as `critical`, `high`, `medium`, or `low`
5. **retention_tier**: Current tier (`hot`, `cold`, or `archive`)
6. **metadata**: Structured metadata including title, detector, affected components, and tags
7. **logs**: Array of structured log entries from the incident window
8. **traces**: Array of trace spans captured during the incident
9. **metrics_snapshots**: Array of metric values at key incident moments
10. **evidence_refs**: Array of references to the evidence ledger
11. **export_format_version**: Integer schema version for forward compatibility
12. **integrity_hash**: SHA-256 digest of all other fields in canonical form

### Integrity Contract

The `integrity_hash` is computed over the canonical JSON representation of all
fields except `integrity_hash` itself.  Canonical JSON uses sorted keys and
minimal whitespace (no pretty-printing).  Any modification to bundle content
MUST invalidate the hash.  Integrity verification is performed on:

- Bundle creation (IBR-001)
- Tier transition (IBR-002)
- Export (IBR-003)
- Periodic archive audit

## Retention Schedule

### Tiered Retention Model

| Tier | Default Retention | Storage Class | Description |
|------|------------------|---------------|-------------|
| Hot | 90 days | Fast local, uncompressed | Active investigation and operations |
| Cold | 1 year (365 days) | Compressed local | Trend analysis and audit readiness |
| Archive | 7 years (2555 days) | Immutable archive | Regulatory compliance retention |

### Transition Rules

1. **Hot to Cold**: Automatic after 90 days.  Bundle is compressed.  IBR-002 emitted.
2. **Cold to Archive**: Automatic after 365 days in cold.  Bundle becomes immutable.  IBR-002 emitted.
3. **Archive to Deletion**: NEVER automatic.  Requires explicit operator action with approval workflow.  Minimum 7-year retention for compliance.

### Configurable Overrides

Operators MAY override default retention periods via deployment configuration:

```toml
[retention.incident_bundles]
hot_days = 90
cold_days = 365
archive_days = 2555
```

Overrides MUST NOT reduce archive retention below 7 years (2555 days) unless
a documented regulatory exemption is on file.

## Export Procedures

### Supported Export Formats

| Format | MIME Type | Use Case |
|--------|-----------|----------|
| JSON | application/json | Full-fidelity interchange |
| CSV | text/csv | Tabular analysis and reporting |
| SARIF | application/sarif+json | Security toolchain integration |

### JSON Export

- Full bundle content preserved
- Integrity hash included for verification
- Re-import MUST produce identical hash

### CSV Export

- Flattened metadata fields: bundle_id, incident_id, created_at, severity,
  retention_tier, title, detected_by, component_count, log_count,
  trace_count, metric_snapshot_count
- One row per bundle
- Header row required

### SARIF Export

- Conforms to SARIF v2.1.0 schema
- Incident metadata mapped to SARIF `run` and `result` objects
- Used for security incidents requiring integration with SAST/DAST pipelines

### Export Access Control

Export operations MUST be logged (IBR-003) with the requesting principal,
export format, and destination.  Export of archive-tier bundles requires
elevated privileges.

## Automated Cleanup

### Sweeper Schedule

The retention sweeper executes on a configurable interval (default: hourly):

1. Scan all bundles for tier transition eligibility
2. Execute tier transitions and emit IBR-002 for each
3. Remove expired ephemeral artifacts per upstream retention policy
4. Emit IBR-004 for each cleanup batch
5. Check storage utilization against thresholds

### Capacity Thresholds

| Level | Threshold | Action |
|-------|-----------|--------|
| Warning | 70% utilization | Emit structured warning with top bundle categories |
| Critical | 85% utilization | Emit critical alert, recommend manual cleanup |

### Cleanup Constraints

- Archive-tier bundles MUST NOT be deleted by automated cleanup
- Required artifacts (per upstream RetentionClass) MUST NOT be deleted
- Only expired ephemeral artifacts are eligible for automated removal

## Compliance Requirements

### Audit Trail

Every retention decision MUST be logged as an auditable event:

- **Create**: Bundle created, tier assigned (IBR-001)
- **Transition**: Tier changed, old/new tier recorded (IBR-002)
- **Export**: Format, destination, requester recorded (IBR-003)
- **Cleanup**: Artifacts removed, count/size recorded (IBR-004)

### Regulatory Obligations

1. Archive-tier bundles MUST be retained for minimum 7 years
2. All retention decisions MUST be queryable by bundle ID or time range
3. Integrity hashes MUST be verified periodically for archive bundles
4. Export audit trail MUST be preserved for the lifetime of the exported bundle

### Evidence Preservation

For regulatory audit readiness:

1. Complete incident bundle MUST be reconstructable from stored components
2. Exported bundles MUST be self-contained (no external dependencies)
3. Integrity verification MUST be performable offline
4. Chain of custody is maintained through the audit trail

## Event Codes

| Code | Trigger | Severity | Required Fields |
|------|---------|----------|-----------------|
| IBR-001 | Bundle created and classified | INFO | bundle_id, incident_id, severity, tier |
| IBR-002 | Retention expired, tier transition | INFO | bundle_id, old_tier, new_tier |
| IBR-003 | Export requested | INFO | bundle_id, format, requester |
| IBR-004 | Cleanup executed | INFO | count, total_bytes_freed |

## Invariants

- **INV-IBR-COMPLETE**: Every stored bundle has all required fields
- **INV-IBR-RETENTION**: Tier transitions follow configured schedule; archive never auto-deleted
- **INV-IBR-EXPORT**: Exported bundles include verifiable integrity hash
- **INV-IBR-INTEGRITY**: SHA-256 integrity hash validates on every read and export

## Governance

### Policy Changes

Changes to retention periods, export formats, or compliance thresholds
require review by the operations track owner (10.8) and approval from the
trust plane owner (PP-03).

### Exception Process

Exceptions to minimum retention periods require:

1. Documented justification
2. Regulatory impact assessment
3. Approval from compliance officer
4. Time-bound waiver with expiration date

### Review Cadence

This policy is reviewed quarterly or upon any regulatory change affecting
data retention requirements.
